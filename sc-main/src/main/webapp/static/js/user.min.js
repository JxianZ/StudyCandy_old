/**
 * Created by toukajiang on 2017/3/28 0028.
 */

/* login-start */
$(function () {
   $("#login-btn").click(function () {
       var username = $("#username").val();
       var password = $("#password").val();
       if(username!=""&&password!=""){
           var data={
               "username":username,
               "password":password
           };
           $.ajax({
               type: "POST",
               url: "/user/login",
               data: data,
               dataType:"json",
               success: function(r){
                   if(r.status==0){
                       alert(r.info);
                       window.location.href="/user/mine";
                   }
                   else {
                       alert(r.info);
                   }
               },
               error: function(r){
                   alert( "Error");
               }
           });
       }
       else{
           alert("用户名密码不能为空");
       }
   }) ;
});




/******     reg-part1-function    ******/

function successCheck() {
    if (
        $("#inputusername").parent().parent().hasClass("has-success")
        &&$("#inputpassword").parent().parent().hasClass("has-success")
        &&$("#confirmpassword").parent().parent().hasClass("has-success")
        &&$("#inputemail").parent().parent().hasClass("has-success")
    )
    {
        $("#part1now").removeClass("disabled");
        $("#part1next").removeClass("disabled");
    }
}

function setSuccess(e) {
    e.parent().parent().removeClass("has-warning");
    e.parent().parent().removeClass("has-error");
    e.parent().parent().addClass("has-success");
}

function setWarning(e) {
    e.parent().parent().removeClass("has-success");
    e.parent().parent().removeClass("has-error");
    e.parent().parent().addClass("has-warning");
}

function setError(e) {
    e.parent().parent().removeClass("has-warning");
    e.parent().parent().removeClass("has-success");
    e.parent().parent().addClass("has-error");
}


function setDefualt(e) {
    e.parent().parent().removeClass("has-warning");
    e.parent().parent().removeClass("has-success");
    e.parent().parent().removeClass("has-error");
}

$(function () {

    /* usernameinput*/

   $("#inputusername").blur(function () {
       if ($(this).val()!=""){
           var username=$(this).val();
           if (username.length<2){
                setError($(this));
                $("#usernamespan").html("用户名过短");
           }
           else if(username.length>=2){
               setSuccess($(this));
               $("#usernamespan").html("");
               successCheck();
           }
       }
       else if($("#usernamespan").html()!=""){
           setWarning($(this));
           $("#usernamespan").html("");
       }
       else if($("#usernamespan").html()==""){
           setDefualt($(this));
       }
   }) ; /* username end */

    /* passowrdinput */

    $("#inputpassword").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#passwordspan").html("字母，数字或者英文符号，最短8位，区分大小写");
        }
        else {
            var passwordstr = /^[a-zA-Z0-9]+$/ ;
            if($("#confirmpassword").val()!=""){
                if(passwordstr.test($(this).val())&&$(this).val().length>8){
                    if($(this).val()==$("#confirmpassword").val()){
                        setSuccess($(this));
                        $("#passwordspan").html("");
                        setSuccess($("#confirmpassword"));
                        $("#cfmpasswordspan").html("");
                        successCheck();
                    }
                    else{
                        setError($(this));
                        $("#passwordspan").html("两次输入密码不一致");
                        setError($("#confirmpassword"));
                        $("#cfmpasswordspan").html("两次输入密码不一致");
                    }
                }
                else{
                    setError($(this));
                    $("#passwordspan").html("密码格式不正确，不可使用大小写字母、数字以外的字符且大于8位");
                }
            }
            else if(!(passwordstr.test($(this).val())&&$(this).val().length>8)){
                setError($(this));
                $("#passwordspan").html("密码只能由字母，数字组成且大于8位");
            }
            else if($("#inputpassword").val()!=""){
                setSuccess($(this));
                $("#passwordspan").html("");
            }
        }
    }); /* password end */

    $("#confirmpassword").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#cfmpasswordspan").html("请再次输入密码");
        }
        else {
            var passwordstr = /^[a-zA-Z0-9]+$/ ;
            if($("#inputpassword").val()!=""){
                if(passwordstr.test($(this).val())&&$(this).val().length>8){
                    if($(this).val()==$("#inputpassword").val()){
                        setSuccess($(this));
                        $("#cfmpasswordspan").html("");
                        setSuccess($(this));
                        $("#passwordspan").html("");
                        successCheck();
                    }
                    else{
                        setError($(this));
                        $("#cfmpasswordspan").html("两次输入密码不一致");
                        setError($("#inputpassword"));
                        $("#passwordspan").html("两次输入密码不一致");
                    }
                }
                else{
                    setError($(this));
                    $("#cfmpasswordspan").html("密码只能由字母，数字组成且大于8位");
                }
            }
            else if(!(passwordstr.test($(this).val())&&$(this).val().length>8)){
                setError($(this));
                $("#cfmpasswordspan").html("密码只能由字母，数字组成且大于8位");
            }
            else if($("#confirmpassword").val()!=""){
                setSuccess($(this));
                $("#cfmpasswordspan").html("");
            }
        }
    });  /* password-cofirm end */

    /* email start */

    $("#inputemail").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#emailspan").html("");
        }
        else{
            var emailstr=$("#inputemail").val();
            if(!emailstr.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)) {
                setError($(this));
                $("#emailspan").html("邮箱格式不正确");
            }
            else{
                setSuccess($(this));
                $("#emailspan").html("");
                successCheck();
            }
        }
    });/* email end*/

    /****************   reg-now-start  ****************/

    $("#part1now").click(function () {
        if($(this).hasClass("disabled")){
            if(!$("#inputusername").parent().parent().hasClass("has-success")){
                $("#inputusername").parent().parent().addClass("has-warning");
            }
            if(!$("#inputpassword").parent().parent().hasClass("has-success")){
                $("#inputpassword").parent().parent().addClass("has-warning");
            }
            if(!$("#confirmpassword").parent().parent().hasClass("has-success")){
                $("#confirmpassword").parent().parent().addClass("has-warning");
            }
            if(!$("#inputemail").parent().parent().hasClass("has-success")){
                $("#inputemail").parent().parent().addClass("has-warning");
            }
            alert("请先完善信息");
        }
        else {
            /* TODO 验证码验证 */
            if(true){
                if($("#check-agree").is(':checked')){
                    var username=$("#inputusername").val();
                    var password=$("#inputpassword").val();
                    var email=$("#inputemail").val();
                    var data={
                        "username":username,
                        "password":password,
                        "email":email
                    };
                    $.ajax({
                        type: "POST",
                        url: "/user/register",
                        data: data,
                        dataType:"json",
                        success: function(r){
                            if(r.status==0){
                                alert("success");
                                $("#reg-nav1").removeClass("reg-nav-on");
                                $("#reg-nav3").addClass("reg-nav-on");
                                $(".reg-part1").toggle();
                                $(".reg-part3").toggle();
                            }
                            else {
                                alert(r.info);
                            }
                        },
                        error: function(r){
                            alert( "Error");
                        }
                    });
                }
                else {
                    alert("您需同意我们的协议方可注册");
                }
            }
            else{
                alert("验证码错误");
                $("#codeinput").focus();
            }
        }
    }) ;
    $("#part1next").click(function () {
        if($(this).hasClass("disabled")){
            if(!$("#inputusername").parent().parent().hasClass("has-success")){
                $("#inputusername").parent().parent().addClass("has-warning");
            }
            if(!$("#inputpassword").parent().parent().hasClass("has-success")){
                $("#inputpassword").parent().parent().addClass("has-warning");
            }
            if(!$("#confirmpassword").parent().parent().hasClass("has-success")){
                $("#confirmpassword").parent().parent().addClass("has-warning");
            }
            if(!$("#inputemail").parent().parent().hasClass("has-success")){
                $("#inputemail").parent().parent().addClass("has-warning");
            }
            alert("请先完善信息");
        }
        else {
            /* TODO 验证码验证 */
            if(true){
                if($("#check-agree").is(':checked')){
                    $("#reg-nav1").removeClass("reg-nav-on");
                    $("#reg-nav2").addClass("reg-nav-on");
                    $(".reg-part1").toggle();
                    $(".reg-part2").toggle();
                }
                else {
                    alert("您需同意我们的协议方可注册");
                }
            }
            else {
                alert("验证码错误");
                $("#codeinput").focus();
            }
        }
    });
    /****************   reg-now-end  ****************/

});/* reg-part1-function end */


/* reg-part2-function start */
/******     reg-part2-function    ******/
$(function(){

    /* realname start */
    $("#inputrealname").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#realnamespan").html("");
        }
        else{
            var realnamestr=$("#inputrealname").val();
            if(!realnamestr.match(/^(?!\s+$)[\u4E00-\u9FA0]+$|^[a-z\s·]+$/i)) {
                setError($(this));
                $("#realnamespan").html("真实姓名不正确");
            }
            else{
                setSuccess($(this));
                $("#realnamespan").html("");
                successCheck();
            }
        }
    });
    /* realname end */

    /* usercode start */
    $("#usercodeinput").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#usercodespan").html("");
        }
        else{
            var usercodestr=$("#usercodeinput").val();
            if(!usercodestr.match(/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/)&&!usercodestr.match(/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/)) {
                setError($(this));
                $("#usercodespan").html("身份证号码不合规范");
            }
            else{
                setSuccess($(this));
                $("#usercodespan").html("");
                successCheck();
            }
        }
    });

    /* usercode end */

    /* phoneinput start */
    $("#phoneinput").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#phonespan").html("");
        }
        else{
            var phonestr=$("#phoneinput").val();
            if(!phonestr.match(/^1[0-9]{10}$/)) {
                setError($(this));
                $("#phonespan").html("手机号码不正确");
            }
            else{
                setSuccess($(this));
                $("#phonespan").html("");
                successCheck();
            }
        }
    });
    /* phoneinput end */

    /* userid start */
    $("#inputuserid").blur(function () {
        if($(this).val()==""){
            setDefualt($(this));
            $("#useridspan").html("");
        }
        else{
            var useridstr=$("#inputuserid").val();
            if(!useridstr.match(/^[0-9]*$/)) {
                setError($(this));
                $("#useridspan").html("id不正确");
            }
            else{
                setSuccess($(this));
                $("#useridspan").html("");
                successCheck();
            }
        }
    });
    /* userid start */
});
